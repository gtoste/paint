(()=>{"use strict";var t;!function(t){t[t.brush=0]="brush",t[t.rectangle=1]="rectangle",t[t.circle=2]="circle",t[t.line=3]="line"}(t||(t={}));const s=function(){function t(t,s,i){this.positions=[],this.r=i,this.color=t,this.ctx=s,this.positions=[]}return t.prototype.add=function(t,s){var i={last_pos:t,pos:s};this.positions.push(i)},t.prototype.draw=function(t){void 0===t&&(t=1);for(var s=0;s<this.positions.length;s++){this.ctx.lineWidth=this.r*t;var i=this.positions[s].last_pos,o=this.positions[s].pos;this.ctx.strokeStyle=this.color,this.ctx.beginPath(),this.ctx.lineCap="round",this.ctx.moveTo(i.x*t,i.y*t),this.ctx.lineTo(o.x*t,o.y*t),this.ctx.stroke()}},t}(),i=function(){function t(){}return t.prototype.draw=function(t){void 0===t&&(t=1)},t}(),o=function(){function t(t,s,i,o,e,n,h){this.ctx=t,this.color=s,this.last_pos=i,this.width=o.x-i.x,this.height=o.y-i.y,this.fill=e,this.proportions=n,this.r=h}return t.prototype.draw=function(t){void 0===t&&(t=1),this.ctx.beginPath(),this.ctx.strokeStyle=this.color,this.ctx.lineWidth=this.r*t,this.proportions&&(this.height=this.width>=this.height?this.width:this.height,this.width=this.height),this.fill?(this.ctx.fillStyle=this.color,this.ctx.fillRect(this.last_pos.x*t,this.last_pos.y*t,this.width*t,this.height*t)):(this.ctx.rect(this.last_pos.x*t,this.last_pos.y*t,this.width*t,this.height*t),this.ctx.stroke())},t}(),e=function(){function t(t,s,i,o,e,n,h){this.ctx=t,this.color=s,this.last_pos=i,this.width=o.x-i.x,this.height=o.y-i.y,this.fill=e,this.proportions=n,this.r=h}return t.prototype.draw=function(t){void 0===t&&(t=1);var s=this.last_pos.x+this.width/2,i=this.last_pos.y+this.height/2;this.ctx.strokeStyle=this.color,this.ctx.lineWidth=this.r*t,this.ctx.beginPath(),this.proportions&&(this.height=this.width>=this.height?this.width:this.height,this.width=this.height),this.ctx.ellipse(s*t,i*t,Math.abs(this.width/2)*t,Math.abs(this.height/2)*t,Math.PI,0,2*Math.PI),this.fill?(this.ctx.fillStyle=this.color,this.ctx.fill()):this.ctx.stroke()},t}(),n=function(){function t(t,s,i,o,e,n){this.ctx=t,this.color=s,this.last_pos=i,this.pos=o,this.proportions=e,this.r=n}return t.prototype.draw=function(t){if(void 0===t&&(t=1),this.ctx.strokeStyle=this.color,this.ctx.beginPath(),this.ctx.lineWidth=this.r*t,this.ctx.moveTo(this.last_pos.x*t,this.last_pos.y*t),this.proportions){var s=Math.abs(this.last_pos.x-this.pos.x),i=Math.abs(this.last_pos.y-this.pos.y);return s>i&&this.ctx.lineTo(this.pos.x*t,this.last_pos.y*t),s<=i&&this.ctx.lineTo(this.last_pos.x*t,this.pos.y*t),void this.ctx.stroke()}this.ctx.lineTo(this.pos.x*t,this.pos.y*t),this.ctx.stroke()},t}();var h=function(){function h(s,i){var o=this;this.canvas=s,this.mask=i,this.ctxCanvas=s.getContext("2d"),this.ctxMask=i.getContext("2d"),this.width=2*window.innerWidth/3,this.color="red",this.r=10,this.last_pos=null,this.history=[],this.mode=t.brush,this.proportions=!1,this.fill=!1,this.resize(),window.onresize=function(){console.log("resoize"),o.resize()},i.onmousedown=function(s){o.bindDraw(s),s.preventDefault(),o.mask.onmouseleave=function(){o.mode==t.brush&&(o.last_pos=null,o.unbindDraw())},o.mask.onmouseenter=function(t){o.bindDraw(t)}},document.body.onmouseup=function(){o.mode!=t.brush&&o.unbindDraw(),o.mask.onmouseenter=null,o.mask.onmouseleave=null},i.onmouseup=function(){o.unbindDraw(),o.mask.onmouseenter=null,o.mask.onmouseleave=null}}return h.prototype.resize=function(){var t=2*window.innerWidth/3,s=t/this.width;this.canvas.width=t,this.canvas.height=9/16*t,this.mask.width=t,this.mask.height=9/16*t,this.redrawWithScale(s)},h.prototype.redrawWithScale=function(t){var s=2*window.innerWidth/3;this.ctxCanvas.clearRect(0,0,s,9/16*s);for(var i=0;i<this.history.length;i++)this.history[i].draw(t)},h.prototype.getMousePos=function(t){var s=this.mask.getBoundingClientRect(),i=this.mask.width/s.width,o=this.mask.height/s.height;return{x:(t.clientX-s.left)*i,y:(t.clientY-s.top)*o}},h.prototype.bindDraw=function(i){var o=this;switch(null==this.last_pos&&(this.last_pos=this.getMousePos(i)),this.mode){case t.brush:var e=new s(this.color,this.ctxCanvas,this.r);this.mask.onmousemove=function(t){var s=o.getMousePos(t);e.add(o.last_pos,s),o.drawBrush(o.last_pos,s)},this.history.push(e);break;case t.rectangle:this.mask.onmousemove=function(t){var s=o.getMousePos(t);o.drawRect(o.last_pos,s),o.current_pos=s};break;case t.circle:this.mask.onmousemove=function(t){var s=o.getMousePos(t);o.drawCircle(o.last_pos,s),o.current_pos=s};break;case t.line:this.mask.onmousemove=function(t){var s=o.getMousePos(t);o.drawLine(o.last_pos,s),o.current_pos=s}}},h.prototype.unbindDraw=function(){if(this.mode==t.rectangle){var s=new o(this.ctxCanvas,this.color,this.last_pos,this.current_pos,this.fill,this.proportions,this.r);this.history.push(s)}else if(this.mode==t.circle){var i=new e(this.ctxCanvas,this.color,this.last_pos,this.current_pos,this.fill,this.proportions,this.r);this.history.push(i)}else if(this.mode==t.line){var h=new n(this.ctxCanvas,this.color,this.last_pos,this.current_pos,this.proportions,this.r);this.history.push(h)}this.history[this.history.length-1].draw(),this.mask.onmousemove=null,this.last_pos=null,this.current_pos=null,this.clearMask()},h.prototype.drawBrush=function(t,s){this.ctxMask.strokeStyle=this.color,this.ctxMask.lineWidth=this.r,this.ctxMask.beginPath(),this.ctxMask.lineCap="round",this.ctxMask.moveTo(t.x,t.y),this.ctxMask.lineTo(s.x,s.y),this.ctxMask.stroke(),this.last_pos=s},h.prototype.drawRect=function(t,s){this.clearMask(),this.ctxMask.beginPath(),this.ctxMask.strokeStyle=this.color,this.ctxMask.lineWidth=this.r;var i=s.x-t.x,o=s.y-t.y;this.proportions&&(i=o=i>=o?i:o),this.fill?(this.ctxMask.fillStyle=this.color,this.ctxMask.fillRect(t.x,t.y,i,o)):(this.ctxMask.rect(t.x,t.y,i,o),this.ctxMask.stroke())},h.prototype.drawCircle=function(t,s){this.clearMask();var i=s.x-t.x,o=s.y-t.y,e=t.x+i/2,n=t.y+o/2;this.ctxMask.strokeStyle=this.color,this.ctxMask.lineWidth=this.r,this.ctxMask.beginPath(),this.proportions&&(i=o=i>=o?i:o),this.ctxMask.ellipse(e,n,Math.abs(i/2),Math.abs(o/2),Math.PI,0,2*Math.PI),this.fill?(this.ctxMask.fillStyle=this.color,this.ctxMask.fill()):this.ctxMask.stroke()},h.prototype.drawLine=function(t,s){if(this.clearMask(),this.ctxMask.strokeStyle=this.color,this.ctxMask.beginPath(),this.ctxMask.moveTo(t.x,t.y),this.proportions){var i=Math.abs(t.x-s.x),o=Math.abs(t.y-s.y);return i>o&&this.ctxMask.lineTo(s.x,t.y),i<=o&&this.ctxMask.lineTo(t.x,s.y),void this.ctxMask.stroke()}this.ctxMask.lineTo(s.x,s.y),this.ctxMask.stroke()},h.prototype.clearCanvas=function(){var t=document.body.offsetWidth;this.ctxCanvas.clearRect(0,0,t,9/16*t),this.history.push(new i)},h.prototype.clearMask=function(){var t=2*window.innerWidth/3;this.ctxMask.clearRect(0,0,t,9/16*t)},h.prototype.undo=function(){var t=2*window.innerWidth/3;this.ctxCanvas.clearRect(0,0,t,9/16*t),this.history.pop();for(var s=0;s<this.history.length;s++)this.history[s].draw()},h.prototype.redo=function(){var t=2*window.innerWidth/3;this.ctxCanvas.clearRect(0,0,t,9/16*t);for(var s=0;s<this.history.length;s++)this.history[s].draw()},h.prototype.setMode=function(t){this.mode=t},h.prototype.getMode=function(){return this.mode},h.prototype.setColor=function(t){this.color=t},h.prototype.setProportions=function(){this.proportions=!this.proportions},h.prototype.getProportions=function(){return this.proportions},h.prototype.setFill=function(){this.fill=!this.fill},h.prototype.getFill=function(){return this.fill},h.prototype.setRange=function(t){this.r=t},h}(),r=document.getElementById("canvas"),c=document.getElementById("mask"),l=document.getElementById("options_download"),a=document.getElementById("options_clear"),p=document.getElementById("options_previous"),u=document.getElementById("options_color_red"),d=document.getElementById("options_color_blue"),x=document.getElementById("options_color_green"),y=document.getElementById("options_color_yellow"),f=document.getElementById("color_picker"),m=document.getElementById("options_brush"),k=document.getElementById("options_rectangle"),g=document.getElementById("options_circle"),v=document.getElementById("options_line"),w=document.getElementById("options_proportions"),M=document.getElementById("options_fill"),_=document.getElementById("range"),b=new h(r,c),I=u,P=m;u.classList.add("selected"),m.classList.add("selected");var B=function(t,s){b.setColor(t),I.classList.remove("selected"),s.classList.add("selected"),I=s},C=function(t,s){b.setMode(t),P.classList.remove("selected"),s.classList.add("selected"),P=s};u.onclick=function(){B("red",u)},d.onclick=function(){B("blue",d)},x.onclick=function(){B("green",x)},y.onclick=function(){B("yellow",y)},f.onchange=function(){B(f.value,f.parentElement)},f.onclick=function(){B(f.value,f.parentElement)},m.onclick=function(){C(t.brush,m)},k.onclick=function(){C(t.rectangle,k)},g.onclick=function(){C(t.circle,g)},v.onclick=function(){C(t.line,v)},w.onclick=function(){b.getProportions()?w.classList.remove("selected"):w.classList.add("selected"),b.setProportions()},M.onclick=function(){b.getFill()?M.classList.remove("selected"):M.classList.add("selected"),b.setFill()},p.onclick=function(){b.undo()},a.onclick=function(){b.clearCanvas()},l.onclick=function(){var t=document.createElement("a");t.href=r.toDataURL(),t.click()},_.onchange=function(){b.setRange(parseInt(_.value))}})();