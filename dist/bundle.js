(()=>{"use strict";var t;!function(t){t[t.brush=0]="brush",t[t.rectangle=1]="rectangle",t[t.circle=2]="circle",t[t.line=3]="line"}(t||(t={}));const o=function(){function t(t,o){this.positions=[],this.color=t,this.ctx=o,this.positions=[]}return t.prototype.add=function(t,o){var s={last_pos:t,pos:o};this.positions.push(s)},t.prototype.draw=function(){for(var t=0;t<this.positions.length;t++){var o=this.positions[t].last_pos,s=this.positions[t].pos;this.ctx.strokeStyle=this.color,this.ctx.beginPath(),this.ctx.lineCap="round",this.ctx.moveTo(o.x,o.y),this.ctx.lineTo(s.x,s.y),this.ctx.stroke()}},t}(),s=function(){function t(){}return t.prototype.draw=function(){},t}(),e=function(){function t(t,o,s,e,i){this.ctx=t,this.color=o,this.last_pos=s,this.width=e.x-s.x,this.height=e.y-s.y,this.fill=i}return t.prototype.draw=function(){this.ctx.beginPath(),this.ctx.strokeStyle=this.color,this.fill?(this.ctx.fillStyle=this.color,this.ctx.fillRect(this.last_pos.x,this.last_pos.y,this.width,this.height)):this.ctx.rect(this.last_pos.x,this.last_pos.y,this.width,this.height),this.ctx.stroke()},t}();var i=function(){function i(o){var s=this;this.canvas=o,this.ctx=o.getContext("2d"),this.resize(),document.body.onresize=function(){s.resize(),s.redo()},this.color="red",this.r=10,this.last_pos=null,this.history=[],o.onmousedown=function(t){s.bindDraw(t)},o.onmouseup=function(){s.unbindDraw()},this.mode=t.brush,this.proportions=!1,this.fill=!1}return i.prototype.resize=function(){var t=2*document.body.offsetWidth/3;this.canvas.width=t,this.canvas.height=9/16*t},i.prototype.getMousePos=function(t){var o=this.canvas.getBoundingClientRect(),s=this.canvas.width/o.width,e=this.canvas.height/o.height;return{x:(t.clientX-o.left)*s,y:(t.clientY-o.top)*e}},i.prototype.bindDraw=function(s){var e=this;switch(this.mode){case t.brush:var i=new o(this.color,this.ctx);this.canvas.onmousemove=function(t){null==e.last_pos&&(e.last_pos=e.getMousePos(t));var o=e.getMousePos(t);i.add(e.last_pos,o),e.draw(e.last_pos,o)},this.history.push(i);break;case t.rectangle:this.last_pos=this.getMousePos(s),this.canvas.onmousemove=function(t){var o=e.getMousePos(t);e.draw(e.last_pos,o),e.current_pos=o};break;case t.circle:this.last_pos=this.getMousePos(s),this.canvas.onmousemove=function(t){var o=e.getMousePos(t);e.draw(e.last_pos,o),e.current_pos=o}}},i.prototype.unbindDraw=function(){if(this.mode==t.rectangle){var o=new e(this.ctx,this.color,this.last_pos,this.current_pos,this.fill);this.history.push(o)}this.canvas.onmousemove=null,this.last_pos=null},i.prototype.draw=function(o,s){switch(this.mode){case t.brush:this.ctx.strokeStyle=this.color,this.ctx.beginPath(),this.ctx.lineCap="round",this.ctx.moveTo(o.x,o.y),this.ctx.lineTo(s.x,s.y),this.ctx.stroke(),this.last_pos=s;break;case t.rectangle:this.redo(),this.ctx.beginPath(),this.ctx.strokeStyle=this.color;var e=s.x-o.x,i=s.y-o.y;this.proportions&&(i=e>i?e:i),e=i,this.fill?(this.ctx.fillStyle=this.color,this.ctx.fillRect(o.x,o.y,e,i)):(this.ctx.rect(o.x,o.y,e,i),this.ctx.stroke());break;case t.circle:this.redo(),this.ctx.beginPath();var n=(s.x-o.x)/2,c=(s.y-o.y)/2;this.ctx.arc(s.x+n,s.y+c,n,0,2*Math.PI),this.ctx.stroke()}},i.prototype.clear=function(){var t=document.body.offsetWidth;this.ctx.clearRect(0,0,t,9/16*t),this.history.push(new s)},i.prototype.undo=function(){var t=document.body.offsetWidth;this.ctx.clearRect(0,0,t,9/16*t),this.history.pop();for(var o=0;o<this.history.length;o++)this.history[o].draw()},i.prototype.redo=function(){var t=document.body.offsetWidth;this.ctx.clearRect(0,0,t,9/16*t);for(var o=0;o<this.history.length;o++)this.history[o].draw()},i.prototype.setMode=function(t){this.mode=t},i.prototype.getMode=function(){return this.mode},i.prototype.setColor=function(t){this.color=t},i.prototype.setProportions=function(){this.proportions=!this.proportions},i.prototype.getProportions=function(){return this.proportions},i.prototype.setFill=function(){this.fill=!this.fill},i.prototype.getFill=function(){return this.fill},i}(),n=document.getElementById("canvas"),c=(document.getElementById("option_download"),document.getElementById("options_clear")),r=document.getElementById("options_previous"),l=document.getElementById("options_color_red"),h=document.getElementById("options_color_blue"),a=document.getElementById("options_color_green"),u=document.getElementById("options_color_yellow"),d=document.getElementById("color_picker"),p=document.getElementById("options_brush"),f=document.getElementById("options_rectangle"),y=document.getElementById("options_circle"),m=document.getElementById("options_line"),g=document.getElementById("options_proportions"),x=document.getElementById("options_fill"),v=new i(n),_=l,w=p;l.classList.add("selected"),p.classList.add("selected");var b=function(t,o){v.setColor(t),_.classList.remove("selected"),o.classList.add("selected"),_=o},k=function(t,o){v.setMode(t),w.classList.remove("selected"),o.classList.add("selected"),w=o};l.onclick=function(){b("red",l)},h.onclick=function(){b("blue",h)},a.onclick=function(){b("green",a)},u.onclick=function(){b("yellow",u)},d.onclick=function(){b(d.value,d.parentElement)},p.onclick=function(){k(t.brush,p)},f.onclick=function(){k(t.rectangle,f)},y.onclick=function(){k(t.circle,y)},m.onclick=function(){k(t.line,m)},g.onclick=function(){v.getProportions()?g.classList.remove("selected"):g.classList.add("selected"),v.setProportions()},x.onclick=function(){v.getFill()?x.classList.remove("selected"):x.classList.add("selected"),v.setFill()},r.onclick=function(){v.undo()},c.onclick=function(){v.clear()}})();